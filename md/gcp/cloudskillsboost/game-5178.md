# [Game] The Arcade Certification Zone June 2024

- https://www.cloudskillsboost.google/games/5178

## 2024-06-17

### Tagging Dataplex Assets

- https://www.cloudskillsboost.google/games/5178/labs/33840
- GSP1145 

#### Task 1. Create a lake, zone, and asset

```
Dataplex is an intelligent data fabric that enables organizations to centrally discover, manage, monitor, and govern their data across data lakes, data warehouses, and data marts to power analytics at scale.

Data Catalog is a fully managed, scalable metadata management service within Dataplex that you can use to tag data assets and search for assets to which you have access.
```
* dataplex - create lake
```
NAME
    gcloud dataplex lakes create - create a Dataplex lake resource

SYNOPSIS
    gcloud dataplex lakes create (LAKE : --location=LOCATION) [--async]
        [--description=DESCRIPTION] [--display-name=DISPLAY_NAME]
        [--labels=[KEY=VALUE,...]] [--metastore-service=METASTORE_SERVICE]
        [--validate-only] [GCLOUD_WIDE_FLAG ...]
```
```
student_02_38b1b15b5e5c@cloudshell:~ (qwiklabs-gcp-00-a7c2c4c89354)$ gcloud dataplex lakes list --location=us-central1
NAME: orders-lake
DISPLAY_NAME: Orders Lake
LAKE_STATUS: ACTIVE
METASTORE_STATUS: NONE
METASTORE: 
SECURITY_STATUS: 
ACTIVE_ASSETS: 
LABELS: 
```
* Dataplex - Lake - Add zone
```
EXAMPLES
    To create a Dataplex zone with name test-zone within lake test-lake in
    location us-central1 with type RAW, and resource location type
    SINGLE_REGION, run:

        $ gcloud dataplex zones create test-zone --location=us-central \
            --lake=test-lake --resource-location-type=SINGLE_REGION \
            --type=RAW
```
* Attach an asset to a zone
```
EXAMPLES
    To create a Dataplex asset with name test-asset, within zone test-zone, in
    lake test-lake, in location us-central1, with resource type STORAGE_BUCKET,
    with resource name projects/test-project/buckets/test-bucket, run:

        $ gcloud dataplex assets create test-asset --location=us-central \
            --lake=test-lake --zone=test-zone \
            --resource-type=STORAGE_BUCKET \
            --resource-name=projects/test-project/buckets/test-bucket
```
#### Task 2. Create a tag template

#### Task 3. Apply a tag template to Dataplex assets

#### Task 4. Search for assets using tags

### Implementing Security in Dataplex

- https://www.cloudskillsboost.google/games/5178/labs/33841
- GSP1157

#### Task 1. Create a lake, zone, and asset in Dataplex

- 這個練習蠻特別的，有兩個使用者帳號。要先用 User 1 具有 Admin 權限的來建立 Dataplex Lake

#### Task 2. Assign Dataplex Data Reader role to another user

- 從 Dataplex > Secure 將 User 2 加入 Dataplex Data Reader 權限

#### Task 3. Test access to Dataplex resources as a Dataplex Data Reader

- 登出 User 1，改登入 User 2
- 測試上傳 test.csv，但會遇到錯誤。因為 Reader 權限無法上傳到 GCS Bucket

#### Task 4. Assign Dataplex Writer role to another user

- 登出 User 2，改登入 User 1 用管理者身份
- 替 User 2 加上 Writer 權限後，登出 User 1。

#### Task 5. Upload new file to Cloud Storage bucket as a Dataplex Data Writer

- 登出 User 1，改登入 User 2
- 上傳 test.csv 到 GCS Bucket

### Hello Cloud Run

- https://www.cloudskillsboost.google/games/5178/labs/33847

#### Task 1. Enable the Cloud Run API and configure your Shell environment

```bash
student_04_a62d2c4e3939@cloudshell:~ (qwiklabs-gcp-03-f01d32800f97)$ gcloud services enable run.googleapis.com
Operation "operations/acf.p2-685951511411-b6ac0947-b0fc-434a-a6f7-74357c944786" finished successfully.
student_04_a62d2c4e3939@cloudshell:~ (qwiklabs-gcp-03-f01d32800f97)$ gcloud config set compute/region us-east4
WARNING: Property validation for compute/region was skipped.
Updated property [compute/region].
student_04_a62d2c4e3939@cloudshell:~ (qwiklabs-gcp-03-f01d32800f97)$ LOCATION="us-east4"
```
#### Task 2. Write the sample application

```bash
student_04_a62d2c4e3939@cloudshell:~ (qwiklabs-gcp-03-f01d32800f97)$ mkdir helloworld && cd helloworld
student_04_a62d2c4e3939@cloudshell:~/helloworld (qwiklabs-gcp-03-f01d32800f97)$ cat >> package.json << EOF
{
  "name": "helloworld",
  "description": "Simple hello world sample in Node",
  "version": "1.0.0",
  "main": "index.js",
  "scripts": {
    "start": "node index.js"
  },
  "author": "Google LLC",
  "license": "Apache-2.0",
  "dependencies": {
    "express": "^4.17.1"
  }
}
EOF
student_04_a62d2c4e3939@cloudshell:~/helloworld (qwiklabs-gcp-03-f01d32800f97)$ cloudshell open index.js
```
- 貼上範例程式：（因為裡面有特殊符號，所以沒辦法直接用 cat 指令產生）

#### Task 3. Containerize your app and upload it to Artifact Registry

```bash
student_04_a62d2c4e3939@cloudshell:~/helloworld (qwiklabs-gcp-03-f01d32800f97)$ cat >> Dockerfile << EOF
# Use the official lightweight Node.js 12 image.
# https://hub.docker.com/_/node
FROM node:12-slim

# Create and change to the app directory.
WORKDIR /usr/src/app

# Copy application dependency manifests to the container image.
# A wildcard is used to ensure copying both package.json AND package-lock.json (when available).
# Copying this first prevents re-running npm install on every code change.
COPY package*.json ./

# Install production dependencies.
# If you add a package-lock.json, speed your build by switching to 'npm ci'.
# RUN npm ci --only=production
RUN npm install --only=production

# Copy local code to the container image.
COPY . ./

# Run the web service on container startup.
CMD [ "npm", "start" ]
EOF
```
```bash
student_04_a62d2c4e3939@cloudshell:~/helloworld (qwiklabs-gcp-03-f01d32800f97)$ gcloud builds submit --tag gcr.io/$GOOGLE_CLOUD_PROJECT/helloworld
Creating temporary archive of 3 file(s) totalling 1.3 KiB before compression.
```
```bash
student_04_a62d2c4e3939@cloudshell:~/helloworld (qwiklabs-gcp-03-f01d32800f97)$ gcloud container images list
NAME: gcr.io/qwiklabs-gcp-03-f01d32800f97/helloworld
Only listing images in gcr.io/qwiklabs-gcp-03-f01d32800f97. Use --repository to list images in other repositories.
```
```bash
student_04_a62d2c4e3939@cloudshell:~/helloworld (qwiklabs-gcp-03-f01d32800f97)$ gcloud auth configure-docker
WARNING: Your config file at [/home/student_04_a62d2c4e3939/.docker/config.json] contains these credential helper entries:
```
```bash
student_04_a62d2c4e3939@cloudshell:~/helloworld (qwiklabs-gcp-03-f01d32800f97)$ docker run -d -p 8080:8080 gcr.io/$GOOGLE_CLOUD_PROJECT/helloworld
student_04_a62d2c4e3939@cloudshell:~/helloworld (qwiklabs-gcp-03-f01d32800f97)$ curl localhost:8080
Hello World!
```
#### Task 4. Deploy to Cloud Run
```bash
student_04_a62d2c4e3939@cloudshell:~/helloworld (qwiklabs-gcp-03-f01d32800f97)$ gcloud run deploy --image gcr.io/$GOOGLE_CLOUD_PROJECT/helloworld --allow-unauthenticated --region=$LOCATIONon=$LOCATION
Service name (helloworld):  
Deploying container to Cloud Run service [helloworld] in project [qwiklabs-gcp-03-f01d32800f97] region [us-east4]
-  Deploying new service...
```