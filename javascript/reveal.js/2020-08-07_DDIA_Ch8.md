---
presentation:
    theme: night.css
    width: 1920
    height: 1080
    slideNumber: true
    hideAddressBar: true
    history: true
---

<style>
.reveal code { color: #e7ad52; }
quote { color: #e7ad52; }
</style>

<!-- slide -->

## Design Data-Intensive Application (DDIA)

Ch.8 The Trouble with Distributed Systems

By [Jazz Yao-Tsung Wang](https://slideshare.net/jazzwang)
2020-08-07 @ Taipei, Taiwan

<!-- slide -->

### 本章大綱

- "完全故障" vs “部分故障"
    - 單機軟體 vs 分散式軟體
    - 超級電腦 vs 雲服務
- 常見分散式系統會遇到的問題
    - 不可靠的網路 `Unreliable Networks`
    - 不可靠的時間 `Unreliable Clocks`

<!-- slide vertical=true -->

### "完全故障" vs "部分故障"

- 單機軟體的「確定性」 <small>`deterministic`</small> <!-- .element: class="fragment" -->
    - 只要硬體沒問題，每次執行單機軟體的結果應該是一樣的 <!-- .element: class="fragment" -->
    - 如果硬體有問題，就會是「藍色螢幕」或 Kernel Panic <!-- .element: class="fragment" -->
    - 完全故障 <small>`fault`</small> <!-- .element: class="fragment" -->
- 分散式軟體的「不確定性」 <small>`nondeterministic`</small> <!-- .element: class="fragment" -->
    - 什麼事情都可能會出錯（網路/電力/空調/機櫃) <!-- .element: class="fragment" -->
    - 部分故障 <small>`partial failure`</small> <!-- .element: class="fragment" -->

<!-- slide vertical=true -->

### 分散式軟體的不確定性

- 奇聞軼事 <small>`anecdote`</small>
    - 電源供應器故障 <small>`PDU [power distribution unit] failures`</small> <!-- .element: class="fragment" -->
    - 網路集線器故障 <small>`switch failures`</small> <!-- .element: class="fragment" -->
    - 整個機櫃跳電 <small>`accidental power cycles of whole racks`</small> <!-- .element: class="fragment" -->
    - 整個資料中心骨幹故障 <small>`whole-DC backbone failures`</small> <!-- .element: class="fragment" -->
    - 整個資料中心電力故障 <small>`whole-DC power failures`</small>  <!-- .element: class="fragment" -->
    - 低血糖的司機開著福特貨卡撞上資料中心的冷卻空調系統 <!-- .element: class="fragment" -->
    <small><quote>
    a hypoglycemic driver smashing his Ford pickup truck into a DC’s HVAC [heating, ventilation, and air conditioning] system
    </quote></small> 

<!-- slide vertical=true -->

### 雲端運算與超級電腦

- 大規模運算系統 <small>`large-scale computing system`</small> 的頻譜兩端
    - 超級電腦 <small>`High-performance Computing (HPC)`</small> <!-- .element: class="fragment" -->
        - 同質性高 <small>`homogeneous`</small>
        - Ex. 電腦叢集 PC Cluster
            - 特殊規格硬體，搭配高速網路連結 Ex. [InfiniBand](https://en.wikipedia.org/wiki/InfiniBand)
            - 共享記憶體 <small>remote direct memory access (RDMA)</small>
    - 雲端運算 <small>`Cloud Computing`</small> <!-- .element: class="fragment" -->
        - 異質性高 <small>`heterogeneous`</small>
            - 採用一般規格的硬體，故障率較高
            - 克洛斯網路拓墣 <small>[Clos Network Topology](https://en.wikipedia.org/wiki/Clos_network) </small>
        - 多用戶 異地資料中心 <small>`multi-tenant datacenters`</small>
        - 隨需自助服務 / 動態資源池 <small>`elastic/on-demand resource allocation`</small>
        - 依用量計價 <small>`metered billing`</small>

<!-- slide vertical=true -->

### HPC 與 Cloud 的不同處

- 作者認為 HPC 的工作（Job）通常靠查核點 `Checkpoints` <!-- .element: class="fragment" -->
    - Job 不成功就視同失敗(`All or Nothing`)。其表現比較類似單機軟體。
- Cloud 比較像實作內部服務 (`internal services`)，使用者的期待包括：<!-- .element: class="fragment" -->
    - 上線服務 (`Online`) - 對比 HPC 的「批次運算 (`Batch`)」
    - 低網路延遲 `low latency` (像在內網一樣)
    - 無法接受停機維修
- 大型系統的基本假設：<!-- .element: class="fragment" -->
    - 每天都有硬體會故障，維運人員要花很多時間處理這些故障
- 分散式系統必須確保就算遇到硬體故障，也能持續運作 <!-- .element: class="fragment" -->
    - 比喻：網路作業系統
    - 第四章提到的 `Rolling Upgrade`
- 雲服務的特徵：跨異地資料中心的通訊 <!-- .element: class="fragment" -->

<!-- slide vertical=true -->

### 基於不可靠的元件，打造可靠的系統

- Building a reliable system from unreliable components
    - 錯誤檢查碼 `Error-correcting codes`
    - TCP 相較於 IP，可以提供更可靠的傳輸
- 雖然上層的軟體元件設計可以解決掉「部分」底層軟硬體造成的故障，但並無法解決所有的故障問題。只能讓剩下的問題易於理解與排除。

<!-- slide -->

### 本章大綱

- "完全故障" vs “部分故障"
    - 單機軟體 vs 分散式軟體
    - 超級電腦 vs 雲服務
- 常見分散式系統會遇到的問題
    - 不可靠的網路 `Unreliable Networks`
    - 不可靠的時間 `Unreliable Clocks`

<!-- slide vertical=true -->

### Shared-nothing System

- <small>`題外話：Hadoop MapReduce 的一個重點觀念`</small>
- 一群靠網路串聯的機器
    - 每台機器只能存取自己的資源(Ex.記憶體與硬碟)
    - 只能透過網路要求存取其他機器的資源
- 是目前打造網路服務的主流架構 <small>`dominant approach`</small>
    - 不需要特殊規格的硬體
    - 可透過異地跨機房的備援 <small>`redundancy`</small> 來達到高可靠性

<!-- slide vertical=true -->

### 非同步網路 <small>`Asynchronous packet networks`</small> 的各種狀況

- 六種非同步網路的異常狀況
    - 封包遺失 (掉包) `packet lost` - Ex. 有人拔掉網路線
    - 封包延遲 `latency` - Ex. 等在佇列/網路負載過重
    - 目的端異常 - Ex. 有人關掉那台機器
    - 目的端暫無回應 - Ex. 那台機器負載過重
    - 目的端已處理要求，但回應封包遺失
    - 目的端已處理要求，但回應封包延遲
- 即使套用「逾時 `Timeout` 」機制，還是無從知道遠端的機器是否有收到回應。

![](https://learning.oreilly.com/library/view/designing-data-intensive-applications/9781491903063/assets/ddia_0801.png)

<!-- slide vertical=true -->

### 