# Download transcripts from Cloud Skills Boost learning paths

## 如何執行

- 若您在 Linux 環境，請先設定 GOOGLE_API_KEY 環境變數
- 以下是在 Github Codespace 執行的範例
```bash
@jazzwang ➜ /workspaces/snippet (master) $ export GOOGLE_API_KEY=< 這裡請填上於 https://aistudio.google.com/app/apikey 取得的 API Key >
@jazzwang ➜ /workspaces/snippet (master) $ time python3 python/requests/cloudskillsboost/dump_transcript.py -h
usage: dump_transcript.py [-h] [--translate TRANSLATE] path_id

Download transcripts from Cloud Skills Boost learning paths.

positional arguments:
  path_id               The ID of the learning path.

options:
  -h, --help            show this help message and exit
  --translate TRANSLATE, -t TRANSLATE
                        Output translation and summary generated by Gemini 1.5 Flash)

real    0m0.969s
user    0m0.875s
sys     0m0.184s
```
- 根據參數說明，必須要填入 `path_id` 當作必要的參數。
  - 舉 https://www.cloudskillsboost.google/paths/9 為例，path_id = 9
  - 舉 https://www.cloudskillsboost.google/paths/118 為例，path_id = 118
  - 您可以自己在 https://www.cloudskillsboost.google/paths 找感興趣的 Learning Path 試著產生對應的 Markdown 輸出。
- 由於使用 Gemini 產生繁體中文翻譯與影片字幕的摘要會花比較久的時間，
  因此如果您只需要每個 Learning Path 的原始英語字幕，
  請只要執行 `dump_transcript.py path_id` 即可。
- 如果需要繁體中文翻譯與摘要的輸出，請執行 `dump_transcript.py -t path_id`

## 執行範例
### 相依套件安裝

本程式相依幾個套件：
- google-generativeai - 呼叫 Google Gemini API 用
- requests - 爬取網址內容用
- bs4 - 解析 HTML 用
- lxml - 解析 HTML 用
- python-dotenv - 讀取環境變數用 (預設 `.env` 檔)

```bash
@jazzwang ➜ /workspaces/snippet (master) $ pip install -q -U 'google-generativeai>=0.8.3' requests bs4 lxml python-dotenv
```
### 純輸出

```bash
@jazzwang ➜ /workspaces/snippet (master) $ time python3 python/requests/cloudskillsboost/dump_transcript.py 249 | tee path-249.md
```
- 解釋：
```
   +---- 計算執行程式的時間 （可忽略）
   |             +---- 要執行的 dump_transcript.py 路徑              +-- Learning Path ID = 249
   |             |                                                  |     +---- 將 STDOUT 結果寫到 `path-249.md` 這個檔案
   |             |                                                  |     |
$ time python3 python/requests/cloudskillsboost/dump_transcript.py 249 | tee path-249.md
```

### 包含繁體中文與摘要的輸出

```bash
@jazzwang ➜ /workspaces/snippet (master) $ export GOOGLE_API_KEY=< 這裡請填上於 https://aistudio.google.com/app/apikey 取得的 API Key >
@jazzwang ➜ /workspaces/snippet (master) $ time python3 python/requests/cloudskillsboost/dump_transcript.py -t 249 | tee path-249.md
```
- 解釋：
```
   +---- 計算執行程式的時間 （可忽略）                                +------ 啟用 Translation （須能存取 Google Gemini API 的網路環境）
   |             +---- 要執行的 dump_transcript.py 路徑              |  +-- Learning Path ID = 249
   |             |                                                  |  |     +---- 將 STDOUT 結果寫到 `path-249.md` 這個檔案
   |             |                                                  |  |     |
$ time python3 python/requests/cloudskillsboost/dump_transcript.py -t 249 | tee path-249.md
```

- 範例輸出：
  - https://github.com/jazzwang/snippet/blob/master/md/gcp/cloudskillsboost/path-249_gemini_for_google_workspace.md
  - https://github.com/jazzwang/snippet/blob/master/md/gcp/cloudskillsboost/path-9_cloud-digital-leader.md

## 已知問題

- 已知限制：
  - 目前這個小 Python Script 只能針對是影片的內容，擷取對應的字幕。
  - 對於 Partner 限定的 Learning Path，因為沒有做身份認證，所以無法生成。
    例如：https://www.cloudskillsboost.google/paths/75 是 "Cloud Digital Leader **Certification** Learning Path" 必須在有登入時，才看得到。
- 已知效能問題：
  - 實測使用 Free API KEY 時，容易因為 Latency 跟 503 Error 回應比例偏高，而發生 Timeout 的錯誤。
    初步懷疑因為 input token （也就是每一段影片的完整英文字幕，加上額外指定的 System Prompt） 比較長，
    加上除了轉成繁體中文翻譯，還要求使用簡潔而精確的語調生成摘要，所以 output token 也會比較多。
    目前還在 Gemini 1.5 Flash 的容許範圍內，只是 API Error Rate 比較高。
  - 暫時解法：我個人是啟用 Gemini API KEY 的 Billing，暫時針對課程內容較長的 Learning Path 就能順利完成翻譯與摘要。

## 2025-08-02

- 參考 [readmoo](../../readmoo/) 的 [pyproject.toml](../../readmoo/pyproject.toml)
- 修改成能夠用 `uv tool install ./cloudskillsboost/` 安裝成執行檔的本地端套件

```bash
~/git/snippet/py/requests$ uv tool install ./cloudskillsboost/
Resolved 37 packages in 861ms
Installed 37 packages in 179ms
 + annotated-types==0.7.0
 + beautifulsoup4==4.13.4
 + bs4==0.0.2
 + cachetools==5.5.2
 + certifi==2025.8.3
 + charset-normalizer==3.4.3
 + cloudskillsboost-dump==0.1.0 (from file:///C:/Users/jazzw/git/snippet/py/requests/cloudskillsboost)
 + colorama==0.4.6
 + dotenv==0.9.9
 + google-ai-generativelanguage==0.6.15
 + google-api-core==2.25.1
 + google-api-python-client==2.178.0
 + google-auth==2.40.3
 + google-auth-httplib2==0.2.0
 + google-generativeai==0.8.5
 + googleapis-common-protos==1.70.0
 + grpcio==1.74.0
 + grpcio-status==1.71.2
 + httplib2==0.22.0
 + idna==3.10
 + lxml==6.0.0
 + proto-plus==1.26.1
 + protobuf==5.29.5
 + pyasn1==0.6.1
 + pyasn1-modules==0.4.2
 + pydantic==2.11.7
 + pydantic-core==2.33.2
 + pyparsing==3.2.3
 + python-dotenv==1.1.1
 + requests==2.32.4
 + rsa==4.9.1
 + soupsieve==2.7
 + tqdm==4.67.1
 + typing-extensions==4.14.1
 + typing-inspection==0.4.1
 + uritemplate==4.2.0
 + urllib3==2.5.0
Installed 1 executable: cloudskillsboost-dump.exe
```

- 測試

```bash
~/git/snippet/py/requests$ which cloudskillsboost-dump
/c/Users/jazzw/.local/bin/cloudskillsboost-dump
```

```bash
~/git/snippet/py/requests$ cloudskillsboost-dump
usage: cloudskillsboost-dump [-h] [--translate TRANSLATE] path_id
cloudskillsboost-dump: error: the following arguments are required: path_id
```

## 2025-08-03

- 用 `aider` 搭配 google `Gemini 2.5 Flash` 模型，畫一張 `dump_transcript.py` 的 sequence diagram

```mermaid
sequenceDiagram
    participant User
    participant main()
    participant requests
    participant BeautifulSoup
    participant json
    participant Gemini API

    User->>main(): Run script with path_id [--translate]
    Note over main(): Load .env, Initialize Gemini model

    main()->>requests: GET learning path HTML (e.g., /paths/ID)
    requests-->>main(): Learning Path HTML
    alt Request Error
        requests--xmain(): HTTP Error
        main()->>User: Print error, Exit
    end
    main()->>BeautifulSoup: Parse Learning Path HTML
    BeautifulSoup-->>main(): Parsed HTML (soup)
    main()->>main(): Extract learning plan title
    main()->>User: Print learning plan title
    main()->>main(): Extract course URLs from HTML

    loop For each course_url in extracted URLs
        main()->>requests: GET course HTML
        requests-->>main(): Course HTML
        alt Request Error
            requests--xmain(): HTTP Error
            main()->>User: Print error, Continue to next course
        end
        main()->>BeautifulSoup: Parse Course HTML
        BeautifulSoup-->>main(): Parsed HTML (soup)
        main()->>main(): Extract course title
        main()->>User: Print course title
        main()->>json: Parse modules JSON from 'ql-course-outline' element
        json-->>main(): Course Modules Data
        alt Parsing Error
            json--xmain(): JSONDecodeError / KeyError
            main()->>User: Print error, Continue to next course
        end

        loop For each module in Course Modules
            main()->>main(): Extract module title
            main()->>User: Print module title
            main()->>main(): Extract activities from module steps

            loop For each activity in activities
                main()->>main(): Extract activity title, type, URL
                main()->>User: Print activity title and URL
                alt If activity_type is "video"
                    main()->>requests: GET video HTML
                    requests-->>main(): Video HTML
                    alt Request Error
                        requests--xmain(): HTTP Error
                        main()->>User: Print error, Skip transcript
                    end
                    main()->>BeautifulSoup: Parse Video HTML
                    BeautifulSoup-->>main(): Parsed HTML (soup)
                    main()->>json: Parse transcript JSON from 'ql-youtube-video' element
                    json-->>main(): Transcript Data
                    alt Parsing Error
                        json--xmain(): JSONDecodeError / KeyError
                        main()->>User: Print error, Skip transcript
                    end
                    main()->>main(): Extract transcript text
                    main()->>User: Print transcript
                    alt If --translate flag is present
                        main()->>Gemini API: Send transcript for translation/summary
                        Gemini API-->>main(): Translated/Summarized Text
                        main()->>User: Print translated/summarized text
                    end
                else
                    main()->>main(): Skip transcript extraction (not a video)
                end
            end
        end
    end
    main()->>User: Script execution complete
```

## 2025-08-05

- Bug: can't parse `Lab`

```bash
~/git/snippet/py/requests$ cloudskillsboost-dump 12
# Cloud Architect Learning Path

- https://www.cloudskillsboost.google/paths/12

[TOC]

Traceback (most recent call last):
  File "<frozen runpy>", line 198, in _run_module_as_main
  File "<frozen runpy>", line 88, in _run_code
  File "C:\Users\jazzw\.local\bin\cloudskillsboost-dump.exe\__main__.py", line 10, in <module>
    sys.exit(main())
             ~~~~^^
  File "C:\Users\jazzw\AppData\Roaming\uv\tools\cloudskillsboost-dump\Lib\site-packages\dump_transcript.py", line 167, in main
    course_title = get_course_title(soup, course_url)
  File "C:\Users\jazzw\AppData\Roaming\uv\tools\cloudskillsboost-dump\Lib\site-packages\dump_transcript.py", line 59, in get_course_title
    raise ValueError(f"Could not find 'ql-title-medium' element in {course_url}")
ValueError: Could not find 'ql-title-medium' element in https://www.cloudskillsboost.google/focuses/2794?parent=catalog&path=12
```