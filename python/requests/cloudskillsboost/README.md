# 

## 如何執行

- 若您在 Linux 環境，請先設定 GOOGLE_API_KEY 環境變數
- 以下是在 Github Codespace 執行的範例
```bash
@jazzwang ➜ /workspaces/snippet (master) $ export GOOGLE_API_KEY=< 這裡請填上於 https://aistudio.google.com/app/apikey 取得的 API Key >
@jazzwang ➜ /workspaces/snippet (master) $ time python3 python/requests/cloudskillsboost/dump_transcript.py -h
usage: dump_transcript.py [-h] [--translate TRANSLATE] path_id

Download transcripts from Cloud Skills Boost learning paths.

positional arguments:
  path_id               The ID of the learning path.

options:
  -h, --help            show this help message and exit
  --translate TRANSLATE, -t TRANSLATE
                        Output translation and summary generated by Gemini 1.5 Flash)

real    0m0.969s
user    0m0.875s
sys     0m0.184s
```
- 根據參數說明，必須要填入 `path_id` 當作必要的參數。
  - 舉 https://www.cloudskillsboost.google/paths/9 為例，path_id = 9
  - 舉 https://www.cloudskillsboost.google/paths/118 為例，path_id = 118
  - 您可以自己在 https://www.cloudskillsboost.google/paths 找感興趣的 Learning Path 試著產生對應的 Markdown 輸出。
- 由於使用 Gemini 產生繁體中文翻譯與影片字幕的摘要會花比較久的時間，
  因此如果您只需要每個 Learning Path 的原始英語字幕，
  請只要執行 `dump_transcript.py path_id` 即可。
- 如果需要繁體中文翻譯與摘要的輸出，請執行 `dump_transcript.py -t path_id`

## 執行範例
### 相依套件安裝

本程式相依幾個套件：
- google-generativeai - 呼叫 Google Gemini API 用
- requests - 爬取網址內容用
- bs4 - 解析 HTML 用
- lxml - 解析 HTML 用
- python-dotenv - 讀取環境變數用 (預設 `.env` 檔)

```bash
@jazzwang ➜ /workspaces/snippet (master) $ pip install -q -U 'google-generativeai>=0.8.3' requests bs4 lxml python-dotenv
```
### 純輸出

```bash
@jazzwang ➜ /workspaces/snippet (master) $ time python3 python/requests/cloudskillsboost/dump_transcript.py 249 | tee path-249.md
```
- 解釋：
```
   +---- 計算執行程式的時間 （可忽略）
   |             +---- 要執行的 dump_transcript.py 路徑              +-- Learning Path ID = 249
   |             |                                                  |     +---- 將 STDOUT 結果寫到 `path-249.md` 這個檔案
   |             |                                                  |     |
$ time python3 python/requests/cloudskillsboost/dump_transcript.py 249 | tee path-249.md
```

### 包含繁體中文與摘要的輸出

```bash
@jazzwang ➜ /workspaces/snippet (master) $ export GOOGLE_API_KEY=< 這裡請填上於 https://aistudio.google.com/app/apikey 取得的 API Key >
@jazzwang ➜ /workspaces/snippet (master) $ time python3 python/requests/cloudskillsboost/dump_transcript.py -t 249 | tee path-249.md
```
- 解釋：
```
   +---- 計算執行程式的時間 （可忽略）                                +------ 啟用 Translation （須能存取 Google Gemini API 的網路環境）
   |             +---- 要執行的 dump_transcript.py 路徑              |  +-- Learning Path ID = 249
   |             |                                                  |  |     +---- 將 STDOUT 結果寫到 `path-249.md` 這個檔案
   |             |                                                  |  |     |
$ time python3 python/requests/cloudskillsboost/dump_transcript.py -t 249 | tee path-249.md
```

- 範例輸出：
  - https://github.com/jazzwang/snippet/blob/master/md/gcp/cloudskillsboost/path-249_gemini_for_google_workspace.md
  - https://github.com/jazzwang/snippet/blob/master/md/gcp/cloudskillsboost/path-9_cloud-digital-leader.md

## 已知問題

- 已知限制：
  - 目前這個小 Python Script 只能針對是影片的內容，擷取對應的字幕。
  - 對於 Partner 限定的 Learning Path，因為沒有做身份認證，所以無法生成。
    例如：https://www.cloudskillsboost.google/paths/75 是 "Cloud Digital Leader **Certification** Learning Path" 必須在有登入時，才看得到。
- 已知效能問題：
  - 實測使用 Free API KEY 時，容易因為 Latency 跟 503 Error 回應比例偏高，而發生 Timeout 的錯誤。
    初步懷疑因為 input token （也就是每一段影片的完整英文字幕，加上額外指定的 System Prompt） 比較長，
    加上除了轉成繁體中文翻譯，還要求使用簡潔而精確的語調生成摘要，所以 output token 也會比較多。
    目前還在 Gemini 1.5 Flash 的容許範圍內，只是 API Error Rate 比較高。
  - 暫時解法：我個人是啟用 Gemini API KEY 的 Billing，暫時針對課程內容較長的 Learning Path 就能順利完成翻譯與摘要。

